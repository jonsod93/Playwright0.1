# Test info

- Name: Unauthenticated Card Purchase Tests >> Card purchase successful
- Location: /home/runner/work/Playwright0.1/Playwright0.1/tests/filmstaden_int/purchases/cardPurchase.spec.js:33:3

# Error details

```
Error: Timed out 10000ms waiting for expect(locator).toContainText(expected)

Locator: locator('//h6[normalize-space()=\'Referensnummer\']')
Expected string: "Referensnummer"
Received: <element(s) not found>
Call log:
  - expect.toContainText with timeout 10000ms
  - waiting for locator('//h6[normalize-space()=\'Referensnummer\']')
    - waiting for" https://test.epayment.nets.eu/Terminal/default.aspx?merchantId=436756&transactionId=9f6faa9d87f74b3aa262eb8e46a4cd67" navigation to finish...
    - navigated to "https://test.epayment.nets.eu/Terminal/default.aspx?merchantId=436756&transactionId=9f6faa9d87f74b3aa262eb8e46a4cd67"


Call Log:
- Timeout 15000ms exceeded while waiting on the predicate
    at /home/runner/work/Playwright0.1/Playwright0.1/tests/filmstaden_int/purchases/cardPurchase.spec.js:68:10
    at /home/runner/work/Playwright0.1/Playwright0.1/tests/filmstaden_int/purchases/cardPurchase.spec.js:63:16
```

# Page snapshot

```yaml
- heading "Betala med kontokort" [level=1]
- 'heading "Rafael: det unga geniet" [level=2]'
- paragraph: Tisdag, 15 juli, 12:00 Filmstaden Scandinavia, Salong 4
- text: Totalt 135.00 kr
- heading "Fyll i dina kortdetaljer" [level=2]
- paragraph: Fyll i dina kortuppgifter nedan och klicka på "Betala" för att slutföra köpet. Filmstaden anlitar Nets Technology för säker betalning och skyddar dig som kortinnehavare mot bedrägerier genom att använda 3D Secure. Detta innebär att du i nästa steg kommer att ombedjas att verifiera din identitet hos din bank eller kortutgivare.
- text: Transaktionen blev inte processad. Vänligen försök igen.
- table:
  - rowgroup:
    - row "Kortnummer Giltighetstid CVV":
      - cell "Kortnummer"
      - cell "Giltighetstid"
      - cell "CVV"
    - row "4925000000000004 12 2030 123 Help to find your credit card verification code":
      - cell "4925000000000004":
        - textbox "Kortnummer": "4925000000000004"
      - cell "12 2030":
        - combobox "month":
          - option "01"
          - option "02"
          - option "03"
          - option "04"
          - option "05"
          - option "06"
          - option "07"
          - option "08"
          - option "09"
          - option "10"
          - option "11"
          - option "12" [selected]
        - combobox "year":
          - option "2025"
          - option "2026"
          - option "2027"
          - option "2028"
          - option "2029"
          - option "2030" [selected]
          - option "2031"
          - option "2032"
          - option "2033"
          - option "2034"
          - option "2035"
          - option "2036"
          - option "2037"
          - option "2038"
          - option "2039"
          - option "2040"
          - option "2041"
          - option "2042"
          - option "2043"
          - option "2044"
          - option "2045"
          - option "2046"
          - option "2047"
          - option "2048"
          - option "2049"
          - option "2050"
          - option "2051"
          - option "2052"
          - option "2053"
          - option "2054"
          - option "2055"
      - cell "123":
        - textbox "CVV": "123"
      - cell "Help to find your credit card verification code":
        - link "Help to find your credit card verification code":
          - /url: CardVerificationDetails.aspx?language=sv-SE
          - img "Help to find your credit card verification code"
    - row "Nets Logo Avbryt Betala":
      - cell "Nets Logo":
        - img "Nets Logo"
      - cell
      - cell "Avbryt Betala":
        - button "Avbryt"
        - button "Betala"
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { LandingPage } from '../../../pages/filmstaden_int/Landingpage';
   3 | import { StartPage } from '../../../pages/filmstaden_int/StartPage';
   4 | import { MoviePage } from '../../../pages/filmstaden_int/MoviePage';
   5 | import { ShowPage } from '../../../pages/filmstaden_int/ShowPage';
   6 | import { NetsPage } from '../../../pages/filmstaden_int/NetsPage';
   7 | import { ReceiptPage } from '../../../pages/filmstaden_int/ReceiptPage';
   8 | import { TestUser } from '../../../testData/testUser';
   9 | import { ValidVisa } from '../../../testData/paymentOptions';
  10 | import * as allure from 'allure-js-commons';
  11 |
  12 | test.describe.parallel('Unauthenticated Card Purchase Tests', () => {
  13 |   let landingPage;
  14 |   let startPage;
  15 |   let moviePage;
  16 |   let showPage;
  17 |   let netsPage;
  18 |   let receiptPage;
  19 |
  20 |   test.beforeEach(async ({ page }) => {
  21 |     landingPage = new LandingPage(page);
  22 |     startPage = new StartPage(page);
  23 |     moviePage = new MoviePage(page);
  24 |     showPage = new ShowPage(page);
  25 |     netsPage = new NetsPage(page);
  26 |     receiptPage = new ReceiptPage(page);
  27 |
  28 |     await page.goto('/');
  29 |     await landingPage.acceptCookies();
  30 |     await landingPage.selectStockholm();
  31 |   });
  32 |
  33 |   test('Card purchase successful', async ({ page }) => {
  34 |     await test.step('Initial setup of variables and tags', async () => {
  35 |       await allure.epic('Purchases');
  36 |       await allure.feature('Successful Card Purchase');
  37 |     });
  38 |
  39 |     await test.step('Navigate to a movie with shows', async () => {
  40 |       await startPage.selectRandomMovie();
  41 |       await moviePage.selectFirstAvailableShowtime(
  42 |         startPage.selectRandomMovie.bind(startPage)
  43 |       );
  44 |     });
  45 |
  46 |     await test.step('Select 1 ticket and fill in required fields', async () => {
  47 |       await showPage.selectOneTicket();
  48 |       await expect(showPage.amountOfTicketsLabel).toContainText('1 st');
  49 |       await showPage.fillEmail(TestUser.email);
  50 |       await showPage.acceptAgeLimit();
  51 |       await showPage.startPayment();
  52 |     });
  53 |
  54 |     await test.step('Make the purchase at Nets', async () => {
  55 |       await netsPage.completePayment(
  56 |         ValidVisa.number,
  57 |         ValidVisa.month,
  58 |         ValidVisa.year,
  59 |         ValidVisa.CVC
  60 |       );
  61 |     });
  62 |
  63 |     await test.step('Control that you end up on the receiptpage', async () => {
  64 |       await expect(async () => {
  65 |         await expect(receiptPage.referensNumberTitleLabel).toContainText(
  66 |           'Referensnummer'
  67 |         );
> 68 |       }).toPass({ timeout: 15000 });
     |          ^ Error: Timed out 10000ms waiting for expect(locator).toContainText(expected)
  69 |     });
  70 |   });
  71 |
  72 |   test('No Email Error', async ({ page }) => {
  73 |     await allure.epic('Purchases');
  74 |     await allure.feature('No Email in checkout');
  75 |
  76 |     await test.step('Navigate to a suitable movie', async () => {
  77 |       await startPage.selectRandomMovie();
  78 |       await moviePage.selectFirstAvailableShowtime(
  79 |         startPage.selectRandomMovie.bind(startPage)
  80 |       );
  81 |     });
  82 |
  83 |     await test.step('Select 1 ticket and fill in necessary fields', async () => {
  84 |       await showPage.acceptAgeLimit();
  85 |       await showPage.startPayment();
  86 |       await expect(async () => {
  87 |         await expect(
  88 |           page.locator(
  89 |             "//div[contains(text(),'Felaktigt format på e-postadress')]"
  90 |           )
  91 |         ).toContainText('Felaktigt format på e-postadress');
  92 |       }).toPass({ timeout: 5000 });
  93 |     });
  94 |   });
  95 | });
  96 |
```